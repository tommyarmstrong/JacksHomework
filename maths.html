<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Maths Homework</title>
    <script src="https://kit.fontawesome.com/35f39a8657.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="maths.css">
  </head>
  <body>
    <div class="content">
      <div class="moduleSelector" id="moduleSelector"></div>
      <h1>Maths Homework</h1>
      <div class="intro" id=intro></div>
      <div id="questionsTable"></div>
      <div class="summaryPercent" id="summaryPercent"></div>
      <div class="summaryText" id="summaryText"></div>
    </div>
    <script>
      // SEE TEST.HTML IN THE SAME FOLDER, FOR A WAY OF READING THESE DATA FROM FILE
      // Set questions manually in JSON as a way to quickly get started on the logic
      const data = {'modules':
        [
        {
            "module_number": "1.1",
            "module_name": "Adding numbers under 10",
            "type": "operator",
            "x1min": 0,
            "x1max": 10,
            "x2min": 0,
            "x2max": 10,
            "operator1": "+",
            "number_questions": 12
          },
          {
            "module_number": "1.2",
            "module_name": "Adding numbers under 20",
            "type": "operator",
            "x1min": 0,
            "x1max": 20,
            "x2min": 0,
            "x2max": 10,
            "operator1": "+",
            "number_questions": 12
          },
          {'module_number': '1.3',
          'module_name': 'Adding tens',
          'questions':
            [
              {
                'type': 'x_operator_y',
                'x': 30,
                'y': 10,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 30,
                'y': 40,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 60,
                'y': 20,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 80,
                'y': 20,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 90,
                'y': 40,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 80,
                'y': 50,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 50,
                'y': 60,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 70,
                'y': 40,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 80,
                'y': 70,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 90,
                'y': 70,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 12,
                'y': 30,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 15,
                'y': 20,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 11,
                'y': 70,
                'operator': '+'
              }
            ]
          },
          {'module_number': '1.4',
          'module_name': 'Adding three single digit numbers',
          'questions':
            [
              {
                'type': 'x_operator_y_operator_z',
                'x': 6,
                'y': 3,
                'z': 2,
                'operator1': '+',
                'operator2': '+',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 2,
                'y': 2,
                'z': 4,
                'operator1': '+',
                'operator2': '+',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 6,
                'y': 2,
                'z': 1,
                'operator1': '+',
                'operator2': '+',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 1,
                'y': 3,
                'z': 7,
                'operator1': '+',
                'operator2': '+',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 8,
                'y': 2,
                'z': 2,
                'operator1': '+',
                'operator2': '+',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 5,
                'y': 3,
                'z': 2,
                'operator1': '+',
                'operator2': '+',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 4,
                'y': 4,
                'z': 4,
                'operator1': '+',
                'operator2': '+',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 9,
                'y': 3,
                'z': 8,
                'operator1': '+',
                'operator2': '+',
              }
            ]
          },
          {
            "module_number": "2.1",
            "module_name": "Subtracting numbers under 10",
            "type": "operator",
            "x1min": 0,
            "x1max": 10,
            "x2min": 0,
            "x2max": 10,
            "operator1": "-",
            "number_questions": 12
          },
          {
            "module_number": "2.2",
            "module_name": "Subtracting from numbers under 20",
            "type": "operator",
            "x1min": 10,
            "x1max": 10,
            "x2min": 0,
            "x2max": 10,
            "operator1": "-",
            "number_questions": 12
          },
          {
            "module_number": "2.3",
            "module_name": "Subtracting two numbers between 10 and 20",
            "type": "operator",
            "x1min": 10,
            "x1max": 10,
            "x2min": 10,
            "x2max": 10,
            "operator1": "-",
            "number_questions": 12
          },
          {'module_number': '2.4',
          'module_name': 'Subtracting two single digit numbers',
          'questions':
            [
              {
                'type': 'x_operator_y_operator_z',
                'x': 12,
                'y': 2,
                'z': 7,
                'operator1': '-',
                'operator2': '-',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 14,
                'y': 4,
                'z': 3,
                'operator1': '-',
                'operator2': '-',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 20,
                'y': 5,
                'z': 5,
                'operator1': '-',
                'operator2': '-',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 14,
                'y': 7,
                'z': 3,
                'operator1': '-',
                'operator2': '-',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 10,
                'y': 8,
                'z': 2,
                'operator1': '-',
                'operator2': '-',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 13,
                'y': 5,
                'z': 4,
                'operator1': '-',
                'operator2': '-',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 18,
                'y': 8,
                'z': 3,
                'operator1': '-',
                'operator2': '-',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 30,
                'y': 20,
                'z': 5,
                'operator1': '-',
                'operator2': '-',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 50,
                'y': 20,
                'z': 10,
                'operator1': '-',
                'operator2': '-',
              },
              {
                'type': 'x_operator_y_operator_z',
                'x': 100,
                'y': 50,
                'z': 49,
                'operator1': '-',
                'operator2': '-',
              }
            ]
          },
          {'module_number': '2.5',
          'module_name': 'Subtracting 10s',
          'questions':
            [
              {
                'type': 'x_operator_y',
                'x': 20,
                'y': 10,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 30,
                'y': 10,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 37,
                'y': 10,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 57,
                'y': 10,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 43,
                'y': 40,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 53,
                'y': 40,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 73,
                'y': 40,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 25,
                'y': 20,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 35,
                'y': 20,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 85,
                'y': 20,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 21,
                'y': 20,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 51,
                'y': 20,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 71,
                'y': 20,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 57,
                'y': 10,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 39,
                'y': 30,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 59,
                'y': 30,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 79,
                'y': 30,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 62,
                'y': 60,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 72,
                'y': 60,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 82,
                'y': 60,
                'operator': '-'
              }
            ]
          },
          {'module_number': '3.1',
          'module_name': 'Two times tables',
          'introduction': "Don't forget that numbers can be multiplied in any order. 2 x 7\
           and 7 x 2 have the same answer.",
          'type': 'times_table',
          'x': 2
          },
          {'module_number': '3.2',
          'module_name': 'Ten times tables',
          'introduction': '<b>Multiplying by 10 is easy!</b> Just add a zero to the end of\
          the number.<br><br>Numbers can be multiplied in any order. 4 x 10  and 10 x 4\
          have the same answer.',
          'type': 'times_table',
          'x': 10
          },   
          {'module_number': '3.3',
          'module_name': 'Five times table',
          'introduction': "Don't forget that numbers can be multiplied in any order. 5 x 7\
           and 7 x 5 have the same answer.",
          'type': 'times_table',
          'x': 5
          },
          {"module_number": "4.1",
          "module_name": "Halves under 20",
          "type": "fraction",
          "numerator": 1,
          "denominator": 2,
          "xmin": 0,
          "xmax": 20, 
          "number_questions": 5
          },
          {"module_number": "4.2",
          "module_name": "Quarters under 20",
          "type": "fraction",
          "numerator": 1,
          "denominator": 4,
          "xmin": 0,
          "xmax": 20, 
          "number_questions": 5
          },
          {"module_number": "4.3",
          "module_name": "Halves under 50",
          "type": "fraction",
          "numerator": 1,
          "denominator": 2,
          "xmin": 0,
          "xmax": 50, 
          "number_questions": 10
          },
          {"module_number": "4.3",
          "module_name": "Halves under 100",
          "type": "fraction",
          "numerator": 1,
          "denominator": 2,
          "xmin": 0,
          "xmax": 100, 
          "number_questions": 10
          },
          {'module_number': '5.1',
          'module_name': 'Mixed operators on single digit numbers',
          'questions':
            [
              {
                'type': 'x_operator_y',
                'x': 8,
                'y': 5,
                'operator': '-'
              },
              {
                'type': 'x_operator_y',
                'x': 3,
                'y': 2,
                'operator': '*'
              },
            ]
          },
          {'module_number': '6',
          'module_name': 'Testing',
          'introduction': 'This module is for testing the code',
          'type': 'operator',
          'x1min': 10,
          'x1max': 49,
          'x2min': 10,
          'x2max': 49,
          'operator1': '+',
          'number_questions': 10,
          'questions':
            [
              {
                'type': 'x_operator_y',
                'x': 800,
                'y': 550,
                'operator': '+'
              },
              {
                'type': 'x_operator_y',
                'x': 350,
                'y': 250,
                'operator': '-'
              }
            ]  
          }
        ]
      }

      // Specify Classes for different question types

      class Question {
        // Methods used by question Classes
        calcRandomValue(min, max) {
          return Math.floor((Math.random() * max) + min);
        }
        evaluateOperation(value1, value2, operator) {
          if ( operator == "+" ) {
            return value1 + value2;
          }
          else if ( operator == "-" ) {
            return value1 - value2;
          }
          else if ( operator == "*" ) {
            return value1 * value2;
          }
          else if ( operator == "/" ) {
            return value1 / value2;
          }
        }
        renderOperator(operator) {
          if (operator == "*") {return ("\u00D7")}
          else if (operator == "/") {return ("\u00F7")}
          else return(operator)
        }
      }

      class OperatorQuestion extends Question {
        #x1min;
        #x1max;
        #x2min;
        #x2max;
        #operator1;
        #x1;
        #x2;
        constructor(data) {
          super();
          this.#x1min = data.x1min;
          this.#x2min = data.x2min;
          this.#x1max = data.x1max;
          this.#x2max = data.x2max;
          this.#operator1 = data.operator1;        
          
          // Calculate two random input values
          this.#x1 = super.calcRandomValue(this.#x1min, this.#x1max)
          this.#x2 = super.calcRandomValue(this.#x2min, this.#x2max)

          // If the operator is minus then only allow a non-negative answer
          if ((this.#operator1 == "-") & (this.#x1 < this.#x2) ) {
            [this.#x1, this.#x2] = [this.#x2, this.#x1] }
        }
        getQuestion() {
          return this.#x1 + " " + super.renderOperator(this.#operator1) + " " + this.#x2 + " = ";
        }  
        getAnswer() {
          return super.evaluateOperation(this.#x1, this.#x2, this.#operator1)
        }
      }

      class FractionQuestion extends Question {
        #x1min;
        #x1max;
        #x1;
        #numerator;
        #denominator;
        constructor(data) {
          super();
          this.#x1min = data.xmin;
          this.#x1max = data.xmax;
          this.#numerator = data.numerator;
          this.#denominator = data.denominator;
          
          // Obtain a random number that will give an integer answer
          this.#x1 = super.calcRandomValue(this.#x1min, this.#x1max*this.#numerator/this.#denominator) * this.#denominator
        }
        getQuestion() {
          if (this.#numerator/this.#denominator == 0.5) {return("\u00BD of " + this.#x1 + " = ")} 
          else if (this.#numerator/this.#denominator == 0.25) {return("\u00BC of " + this.#x1 + " = ")}
          else {
            return this.#numerator + " / " + this.#denominator + " of " + this.#x1 + " = ";
          }
        }  
        getAnswer() {
          return this.#x1*this.#numerator/this.#denominator;
        }
      }

      class SpecificOperatorQuestion extends Question {
        #x1;
        #x2;
        #operator1;
        constructor(x, y, operator) {
          super();
          this.#x1 = x;
          this.#x2 = y;
          this.#operator1 = operator;        
        }
        getQuestion() {
          return this.#x1 + " " + super.renderOperator(this.#operator1) + " " + this.#x2 + " = ";
        }  
        getAnswer() {
          return super.evaluateOperation(this.#x1, this.#x2, this.#operator1)
        }
      }

      class HardCodedQuestion {
        #question;
        #answer;
        constructor(question, answer) {
          this.#question = question;
          this.#answer = answer;
        }
        getQuestion() {
          return this.#question;
        }  
        getAnswer() {
          return this.#answer;
        }
      }

      class HardCodedHalf {
        #x;
        constructor(question) {
          this.#x = question;
        }
        getQuestion() {
          return "\u00BD of " + this.#x + " = ";
        }  
        getAnswer() {
          return this.#x / 2;
        }
      }

      class HardCodedQuarter {
        #x;
        constructor(question) {
          this.#x = question;
        }
        getQuestion() {
          return "\u00BC of " + this.#x + " = ";
        }  
        getAnswer() {
          return this.#x / 4;
        }
      }

      // BEGINNING OF THE FUNCTIONALITY

      // Create a module selector
      //
      var selectModules = document.createElement("select");
      selectModules.id = "modulesList";
      // Create first option as a holding point
      var first_option = document.createElement("option");
      first_option.value = 0;
      first_option.text = "Select a module...";
      selectModules.appendChild(first_option);
      // Create additional options based on the modules in the data
      for (let i = 0; i < data.modules.length; i++) {
          var option = document.createElement("option");
          option.value = data.modules[i].module_number;
          option.text = data.modules[i].module_number + " - " + data.modules[i].module_name;
          selectModules.appendChild(option);
      }
      document.getElementById('moduleSelector').appendChild(selectModules);

      // When a module is selected call a function to create an array
      // of questions
      //
      document.getElementById("modulesList").onchange = selectQuestions;

      function selectQuestions() {
        // Function to create an array of question objects when a module is selected
        for (let i =0; i < data.modules.length; i++) {
          if ( data.modules[i].module_number == this.value ) {
            let module = data.modules[i];
            let introduction = module.introduction;
            
            // Create an array for the quetion objects
            let questions = [];
            // Find the type of questions and construct objects 
            // from appropriate the question Class, then append
            // to the array
            // 
            // First questions that are auto generated from metadata
            if ( module.type == "operator" ) {
              for (let i=0; i<module.number_questions; i++) {
                question = new OperatorQuestion(module);          
                questions.push(question);
              }
            }
            else if ( module.type == "fraction" ) {
              for (let i=0; i<module.number_questions; i++) {
                question = new FractionQuestion(module);          
                questions.push(question);
              }
            }
            else if ( module.type == "times_table" ) {
              for (let i=1; i<6; i++) {
                question = new SpecificOperatorQuestion(i, module.x, "*");          
                questions.push(question);
              }
              for (let i=6; i<11; i++) {
                question = new SpecificOperatorQuestion(i, module.x, "*");          
                questions.push(question);
                question = new SpecificOperatorQuestion(module.x, i, "*");          
                questions.push(question);
              }
              question = new SpecificOperatorQuestion(module.x, 20, "*");          
              questions.push(question);
              question = new SpecificOperatorQuestion(module.x, 100, "*");          
              questions.push(question);
              question = new SpecificOperatorQuestion(40, module.x, "*");          
              questions.push(question);
              question = new SpecificOperatorQuestion(module.x, 70, "*");          
              questions.push(question);
            }

            // Then specific questions, which can be added
            if (module.questions) {
              for (let i=0; i<module.questions.length; i++) {
                if ( module.questions[i].type == "hard_coded" ) {
                  //Generate hardcoded object type
                  question = new HardCodedQuestion(module.questions[i].question, module.questions[i].answer);
                  questions.push(question);
                }
                else if ( module.questions[i].type == "x_operator_y" ) {
                  question = new SpecificOperatorQuestion(module.questions[i].x, module.questions[i].y, module.questions[i].operator);
                  questions.push(question);
                }
                else if ( module.questions[i].type == "half" ) {
                  question = new HardCodedHalf(module.questions[i].question);
                  questions.push(question);
                }
                else if ( module.questions[i].type == "quarter" ) {
                  question = new HardCodedQuarter(module.questions[i].question);
                  questions.push(question);
                }
              }
            }
            // Pass the array of questions to a function that will create the HTML
            displayQuestions(introduction, questions);         
          }  
        }
      }

      function displayQuestions (introduction, questions) {
        // Display the introduction if there is one
        if ( introduction ) {
          document.getElementById("intro").innerHTML = introduction + "<br><br>"
        }
        else {
          document.getElementById("intro").innerHTML = ""
        }
        // Create a table to display the questions
        var table = document.createElement('table');
        table.id = "questions_table";

        // For each question in the array create a table row
        for( let i=0; i<questions.length; i++ ) {
          var row = table.insertRow();
                    
          // Create a cell for the question
          var questionCell = row.insertCell();
          questionCell.appendChild(document.createTextNode(questions[i].getQuestion()));
          questionCell.id = "question_" + i;
          questionCell.className = "question";

          // Create a cell for the response
          responseInput = document.createElement("input");
          responseInput.id = "response_value_" + i;
          responseInput.type = "number";
          responseInput.min = "0";
          responseInput.max = "999";
          var responseCell = row.insertCell();
          responseCell.appendChild(responseInput);
          responseCell.id = "response_" + i;

          // Create a cell to display if the answer is correct or incorrect
          var checkAnswerCell = row.insertCell();
          checkAnswerCell.id = "checkAnswer_" + i;
          // Insert the correct answer as an attribue to check against later
          checkAnswerCell.setAttribute("correct_answer", questions[i].getAnswer());
        }

        // Create a button to check the answers
        var checkButton = document.createElement('button')
        checkButton.type = "button"
        checkButton.id = "checkButton"
        checkButton.class = "button"
        checkButton.setAttribute("onclick", "checkAll()")
        checkButton.setAttribute("class", "button")
        checkButton.appendChild(document.createTextNode("Check Answers"));

        // Insert a row to the bottom of the questions table 
        // and append the button to check answers
        var row = table.insertRow();
        var buttonCell =  row.insertCell();
        buttonCell.setAttribute("colspan", "2")
        buttonCell.appendChild(checkButton);

        // Update the parent div 'questionsTable' with the new table
        let questionsParent = document.getElementById('questionsTable');
        let questionsFirstChild = document.getElementById('questionsTable').firstElementChild;
        if ( questionsFirstChild == null) {
          // If the parent div (questionsTable) has no child then
          // append the table as a child
          questionsParent.appendChild(table);
        }
        else {
          // Else replace the table in the child of the parent div
          questionsParent.replaceChild(table, questionsFirstChild);
        }
        // Clear previous scores and comments
        document.getElementById("summaryPercent").innerHTML = "";
        document.getElementById("summaryText").innerHTML = "";
      }

      function checkAll() {
        // Check the given answers and report the total score      
        // Use icons from Font Awesome to indicate correct / incorrect answers
        correctAnswer = '<i class="fa-regular fa-face-smile fa-2x" style="color:green"></i>'
        incorrectAnswer = '<i class="fa-solid fa-poop fa-2x" style="color:#662B00"></i>'

        // Check the answer in each row of the table against the correct answer 
        // and update the total score
        let totalScore = 0;
        let table_length = document.getElementById("questions_table").rows.length - 1;
        for (let i = 0; i < table_length; i++) {
          response = document.getElementById("response_value_" + i).value
          // The correct answer was embedded in the HTML earlier for ease of use
          answer = document.getElementById("checkAnswer_" + i).getAttribute("correct_answer")
          if ( response == answer ) {
            document.getElementById("checkAnswer_" + i).innerHTML = correctAnswer;
            totalScore += 1;
          }
          else {
            document.getElementById("checkAnswer_" + i).innerHTML = incorrectAnswer;
          }
        }
        // Show the total score as a percentage
        summaryPercent = Math.round(totalScore / table_length * 100);
        document.getElementById("summaryPercent").innerHTML = summaryPercent + "%";
        document.getElementById("summaryText").innerHTML = summarizeResults(summaryPercent)
        document.getElementById("summaryPercent").scrollIntoView();
      }

      function summarizeResults(percent) {
        // Assess thre results and provide feedback
        if ( percent == 0 ) {
          return "You must be having a laugh!! You're Spurs!!";
          }
        else if ( percent < 20 ) {
          return "You need a lot of help. You're West Ham.";
          }
        else if ( percent < 50 ) {
          return "You need a lot more practise. You're Arsenal";
          }
        else if ( percent < 67 ) {
          return "Not too bad! You're definately getting there. You're Exeter City.";
          }
        else if ( percent < 80 ) {
          return "You were so close. Well done! You're Haringey Borough!";
          }
        else if ( percent < 100 ) {
          return "Wow that was good! Almost perfect. You're Beacon Knights.";
          }
        else if ( percent == 100 ) {
          return "NEWCASTLE! NEWCASTLE! NEWCASTLE! NEWCASTLE! <br><br> You're a genius! WELL DONE!";
          }
        else return ""
      }
   </script>
  </body>
</html>
